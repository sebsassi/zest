<!doctype html>
<html class="no-js" lang="en" data-content_root="./">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="index" title="Index" href="genindex.html" /><link rel="search" title="Search" href="search.html" /><link rel="next" title="Anatomy of zest" href="anatomy.html" /><link rel="prev" title="Getting started" href="getting_started.html" />

    <!-- Generated with Sphinx 8.2.3 and Furo 2024.08.06 -->
        <title>Theoretical background - zest 0.1.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=8f2a1f02" />
    <link rel="stylesheet" type="text/css" href="_static/styles/furo.css?v=354aac6f" />
    <link rel="stylesheet" type="text/css" href="_static/styles/furo-extensions.css?v=302659d7" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-with-moon" viewBox="0 0 24 24">
    <title>Auto light/dark, in light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path style="opacity: 50%" d="M 5.411 14.504 C 5.471 14.504 5.532 14.504 5.591 14.504 C 3.639 16.319 4.383 19.569 6.931 20.352 C 7.693 20.586 8.512 20.551 9.25 20.252 C 8.023 23.207 4.056 23.725 2.11 21.184 C 0.166 18.642 1.702 14.949 4.874 14.536 C 5.051 14.512 5.231 14.5 5.411 14.5 L 5.411 14.504 Z"/>
      <line x1="14.5" y1="3.25" x2="14.5" y2="1.25"/>
      <line x1="14.5" y1="15.85" x2="14.5" y2="17.85"/>
      <line x1="10.044" y1="5.094" x2="8.63" y2="3.68"/>
      <line x1="19" y1="14.05" x2="20.414" y2="15.464"/>
      <line x1="8.2" y1="9.55" x2="6.2" y2="9.55"/>
      <line x1="20.8" y1="9.55" x2="22.8" y2="9.55"/>
      <line x1="10.044" y1="14.006" x2="8.63" y2="15.42"/>
      <line x1="19" y1="5.05" x2="20.414" y2="3.636"/>
      <circle cx="14.5" cy="9.55" r="3.6"/>
    </svg>
  </symbol>
  <symbol id="svg-moon-with-sun" viewBox="0 0 24 24">
    <title>Auto light/dark, in dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path d="M 8.282 7.007 C 8.385 7.007 8.494 7.007 8.595 7.007 C 5.18 10.184 6.481 15.869 10.942 17.24 C 12.275 17.648 13.706 17.589 15 17.066 C 12.851 22.236 5.91 23.143 2.505 18.696 C -0.897 14.249 1.791 7.786 7.342 7.063 C 7.652 7.021 7.965 7 8.282 7 L 8.282 7.007 Z"/>
      <line style="opacity: 50%" x1="18" y1="3.705" x2="18" y2="2.5"/>
      <line style="opacity: 50%" x1="18" y1="11.295" x2="18" y2="12.5"/>
      <line style="opacity: 50%" x1="15.316" y1="4.816" x2="14.464" y2="3.964"/>
      <line style="opacity: 50%" x1="20.711" y1="10.212" x2="21.563" y2="11.063"/>
      <line style="opacity: 50%" x1="14.205" y1="7.5" x2="13.001" y2="7.5"/>
      <line style="opacity: 50%" x1="21.795" y1="7.5" x2="23" y2="7.5"/>
      <line style="opacity: 50%" x1="15.316" y1="10.184" x2="14.464" y2="11.036"/>
      <line style="opacity: 50%" x1="20.711" y1="4.789" x2="21.563" y2="3.937"/>
      <circle style="opacity: 50%" cx="18" cy="7.5" r="2.169"/>
    </svg>
  </symbol>
  <symbol id="svg-pencil" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-pencil-code">
      <path d="M4 20h4l10.5 -10.5a2.828 2.828 0 1 0 -4 -4l-10.5 10.5v4" />
      <path d="M13.5 6.5l4 4" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
  <symbol id="svg-eye" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-eye-code">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M10 12a2 2 0 1 0 4 0a2 2 0 0 0 -4 0" />
      <path
        d="M11.11 17.958c-3.209 -.307 -5.91 -2.293 -8.11 -5.958c2.4 -4 5.4 -6 9 -6c3.6 0 6.6 2 9 6c-.21 .352 -.427 .688 -.647 1.008" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>

<a class="skip-to-content muted-link" href="#furo-main-content">Skip to content</a>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="index.html"><div class="brand">zest 0.1.0 documentation</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
          <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="index.html">
  
  
  <span class="sidebar-brand-text">zest 0.1.0 documentation</span>
  
</a><form class="sidebar-search-container" method="get" action="search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="getting_started.html">Getting started</a></li>
<li class="toctree-l1 current current-page"><a class="current reference internal" href="#">Theoretical background</a></li>
<li class="toctree-l1"><a class="reference internal" href="anatomy.html">Anatomy of zest</a></li>
<li class="toctree-l1"><a class="reference internal" href="reference.html">Library reference</a></li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          <div class="view-this-page">
  <a class="muted-link" href="_sources/introduction.rst.txt" title="View this page">
    <svg><use href="#svg-eye"></use></svg>
    <span class="visually-hidden">View this page</span>
  </a>
</div>
<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
              <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main" id="furo-main-content">
          <section id="theoretical-background">
<h1>Theoretical background<a class="headerlink" href="#theoretical-background" title="Link to this heading">¶</a></h1>
<p>This section aims to give a brief introduction to the mathematics that underlie this library. This
introduction assumes basic mathematical knowledge of linear algebra, integration, and basis
functions.</p>
<section id="spherical-harmonics">
<h2>Spherical harmonics<a class="headerlink" href="#spherical-harmonics" title="Link to this heading">¶</a></h2>
<p>Spherical harmonics, denoted <span class="math notranslate nohighlight">\(Y_{lm}(\theta,\varphi)\)</span>, are a collection of special functions
defined on the sphere. They form a complete orthogonal basis on the sphere <span class="math notranslate nohighlight">\(S^2\)</span>, meaning
that any square integrable function <span class="math notranslate nohighlight">\(f(\theta,\varphi)\in L^2(S^2)\)</span> can be represented as a
linear combination of (possibly an infinite number of) spherical harmonics</p>
<div class="math-wrapper docutils container">
<div class="math notranslate nohighlight">
\[f(\theta, \varphi) = \sum_{l=0}^{\infty}\sum_{|m|\leq l}f_{lm}Y_{lm}(\theta,\varphi),\]</div>
</div>
<p>such that</p>
<div class="math-wrapper docutils container">
<div class="math notranslate nohighlight">
\[\int_{S^2}Y_{lm}(\theta,\varphi)^*Y_{l'm'}(\theta,\varphi)\,d\Omega = N_{lm}\delta_{ll'}\delta_{mm'}.\]</div>
</div>
<p>Here <span class="math notranslate nohighlight">\(\delta_{ij}\)</span> is the Kroenecker delta, and <span class="math notranslate nohighlight">\(N_{lm}\)</span> is a normalization constant
that depends on the normalization convention of spherical harmonics.</p>
<p>Spherical harmonics come in two forms: complex spherical harmonics, which we denote as <span class="math notranslate nohighlight">\(Y_l^m\)</span>
with upper index <span class="math notranslate nohighlight">\(m\)</span>, and real spherical harmonics which we denote as <span class="math notranslate nohighlight">\(Y_{lm}\)</span> with
upper index <span class="math notranslate nohighlight">\(m\)</span>. This library has been built around real spherical harmonics with currently
no support for full complex spherical harmonics. Therefore this introduction is presented in terms
of real spherical harmonics, apart from cases where complex spherical harmonics are necessary. The
real and complex spherical harmonics are related via a linear transformation</p>
<div class="math-wrapper docutils container">
<div class="math notranslate nohighlight">
\[\begin{split}Y_{lm} =
\begin{cases}
    \frac{i}{\sqrt{2}}(Y_l^m-(-1)^m Y_l^{-m}) &amp; \text{if} m &lt; 0,\\
    Y_l^0 &amp; \text{if} m = 0,\\
    \frac{1}{\sqrt{2}}(Y_l^{-m}+(-1)^m Y_l^m) &amp; \text{if} m &gt; 0.\\
\end{cases}\end{split}\]</div>
</div>
<p>Spherical harmonics can be expressed in closed form using the associated Legendre polynomials
<span class="math notranslate nohighlight">\(P_l^m(x)\)</span>. There are multiple possible conventions for writing the spherical harmonic
functions depending on two factors: the normalization discussed above, and the presence of the
so-called Condon–Shortley phase. For brevity, we do not write down all possible permutations of
conventions here. Two conventions of note are the geodesy convention</p>
<div class="math-wrapper docutils container">
<div class="math notranslate nohighlight">
\[Y_l^m(\theta,\varphi) = \sqrt{(2l+1)\frac{(l-m)!}{(l+m)!}}P_l^m(\cos\theta)e^{im\varphi},\]</div>
</div>
<p>and quantum mechanics convention</p>
<div class="math-wrapper docutils container">
<div class="math notranslate nohighlight">
\[Y_l^m(\theta,\varphi) = (-1)^{m}\sqrt{\frac{2l+1}{4\pi}\frac{(l-m)!}{(l+m)!}}P_l^m(\cos\theta)e^{im\varphi}.\]</div>
</div>
<p>For the geodesy convention, the normalization constant is <span class="math notranslate nohighlight">\(N_{lm} = 4\pi\)</span>, whereas the
quantum mechanics spherical harmonics are unit normalized with <span class="math notranslate nohighlight">\(N_{lm} = 1\)</span>. The quantum
mechanics convention also includes the Condon–Shortley phase factor <span class="math notranslate nohighlight">\((-1)^m\)</span>, whereas the
geodesy convention doesn’t.</p>
<p>This library is convention agnostic to an extent. It supports both Condon–Shortley phase
conventions, and allows a choice between unit and <span class="math notranslate nohighlight">\(4\pi\)</span> normalization, but does not at
present support all possible normalization conventions.</p>
<p>For completeness, we also write down the real spherical harmonics in the geodesy convention</p>
<div class="math-wrapper docutils container">
<div class="math notranslate nohighlight">
\[\begin{split}Y_{lm}(\theta,\varphi) =
\begin{cases}
    \sqrt{2(2l+1)\frac{(l-m)!}{(l+m)!}}P_l^m(\cos\theta)\sin(|m|\varphi) &amp; \text{if} m &lt; 0,\\
    \sqrt{2l+1}P_l^m(\cos\theta) &amp; \text{if} m = 0,\\
    \sqrt{2(2l+1)\frac{(l-m)!}{(l+m)!}}P_l^m(\cos\theta)\cos(m\varphi) &amp; \text{if} m &gt; 0,\\
\end{cases}\end{split}\]</div>
</div>
<p>It is commonplace to absorb the normalization to the associated Legendre polynomials. Therefore we
define</p>
<div class="math-wrapper docutils container">
<div class="math notranslate nohighlight">
\[\bar{P}_l^m(x)=\sqrt{(2l+1)\frac{(l-m)!}{(l+m)!}}P_l^m(x),\]</div>
</div>
<p>for, e.g., the <span class="math notranslate nohighlight">\(4\pi\)</span> normalization convention.</p>
</section>
<section id="spherical-harmonic-transforms">
<h2>Spherical harmonic transforms<a class="headerlink" href="#spherical-harmonic-transforms" title="Link to this heading">¶</a></h2>
<p><em>Spherical harmonic transform</em> here refers to the process of finding the expansion coefficients
<span class="math notranslate nohighlight">\(f_{lm}\)</span> given a function <span class="math notranslate nohighlight">\(f(\theta,\varphi)\)</span>. This is in principle straightforward,
since it is easy to check that the coefficients can be written as</p>
<div class="math-wrapper docutils container">
<div class="math notranslate nohighlight">
\[f_{lm} = \frac{1}{N_{lm}}\int_{S^2}f(\theta,\varphi)Y_{lm}(\theta,\varphi)\,d\Omega.\]</div>
</div>
<p>If we express the spherical harmonics in terms of the associated Legendre polynomials and
trigonometric functions, this can be written as</p>
<div class="math-wrapper docutils container">
<div class="math notranslate nohighlight">
\[\begin{split}f_{lm} = \frac{1}{N_{lm}}\int_{-1}^{1}\bar{P}_l^m(\cos\theta)\int_0^{2\pi}
\begin{Bmatrix}
    \cos(m\varphi)\\
    \sin(|m|\varphi)
\end{Bmatrix}
f(\theta,\varphi)\,\varphi\,d\cos\theta.\end{split}\]</div>
</div>
<p>The trigonometric functions inside the curly braces denote the two different options. It is worth
noting that the inner integral over <span class="math notranslate nohighlight">\(\varphi\)</span> is a Fourier transform.</p>
<p>In practice, given an arbitrary function, the integrals won’t generally have a closed form
solution, which means that in practice the integrals have to be evaluated numerically. Naively,
one could do this by providing a function that evaluates <span class="math notranslate nohighlight">\(Y_{lm}(\theta,\varphi)\)</span>, and use
any numerical integration routine, but this is profoundly inefficient in all aspects.</p>
<p>Exact numerical evaluation of all expansion coefficients is impossible, because that would require
evaluating <span class="math notranslate nohighlight">\(f(\theta,\varphi)\)</span> at an infinite number of points. To that end, we can seek an
approximation given a finite set of points. Here we can rely on so-called numerical quadrature
rules. The basic idea is that given a domain <span class="math notranslate nohighlight">\(X\)</span>, we can find a collection of points
<span class="math notranslate nohighlight">\(x_i\in X\)</span>, with <span class="math notranslate nohighlight">\(i = 1,2,\ldots,N\)</span>, and a corresponding set of weights
<span class="math notranslate nohighlight">\(w_i\in\mathbb{R}\)</span>, such that for any polynomial such that we can approximate the integral of
a function <span class="math notranslate nohighlight">\(f:X\rightarrow\mathbb{R}\)</span> with a sum</p>
<div class="math-wrapper docutils container">
<div class="math notranslate nohighlight">
\[\int_Xf(x)\,dx\approx\sum_{i=1}^N w_if(x_i).\]</div>
</div>
<p>In particular, it is possible to find a quadrature rule that integrates polynomials up to some
order exactly. That is, there exists an integer <span class="math notranslate nohighlight">\(M\geq N\)</span> such that for any polynomial
<span class="math notranslate nohighlight">\(P_M(x)\)</span> of order <span class="math notranslate nohighlight">\(M\)</span>, we have an exact equality</p>
<div class="math-wrapper docutils container">
<div class="math notranslate nohighlight">
\[\int_XP_M(x)\,dx\approx\sum_{i=1}^N w_iP_X(x_i).\]</div>
</div>
<p>A particular example of such a quadrature rule is Gauss–Legendre quadrature for functions defined
on the interval <span class="math notranslate nohighlight">\([-1,1]\)</span>, for which <span class="math notranslate nohighlight">\(M = 2N - 1\)</span>. The Gauss–Legendre quadrature rule
is the basis of the fast spherical harmonic transform.</p>
<p>To return back to the spherical harmonic expansion coefficients, let <span class="math notranslate nohighlight">\(\theta_i\)</span>, with
<span class="math notranslate nohighlight">\(i = 0,\ldots,L\)</span>, be such that <span class="math notranslate nohighlight">\(z_i = cos\theta_i\in[-1,1]\)</span> are the Gauss–Legendre
quadrature nodes, and let <span class="math notranslate nohighlight">\(\varphi_j = 2\pi j/(2L + 1)\)</span>, with <span class="math notranslate nohighlight">\(j = 0,\ldots,2L\)</span>. We can
now write</p>
<div class="math-wrapper docutils container">
<div class="math notranslate nohighlight">
\[\begin{split}f_{lm}\approx\sum_{i=0}{L}w_i\bar{P}_l^m(z_i)\sum_{j=0}^{2L}
\begin{Bmatrix}
    \cos(m\varphi_j)\\
    \sin(|m|\varphi_j)
\end{Bmatrix}
f(\theta_i,\varphi_j).\end{split}\]</div>
</div>
<p>Now, if <span class="math notranslate nohighlight">\(f_L(\theta,\varphi)\)</span> is a function which can be expressed as a finite linear
combination of spherical harmonics such that</p>
<div class="math-wrapper docutils container">
<div class="math notranslate nohighlight">
\[f_L(\theta, \varphi) = \sum_{l=0}{L}\sum_{|m|\leq l}f_{lm}Y_{lm}(\theta,\varphi),\]</div>
</div>
<p>then the above relation will be exact. Therefore, <span class="math notranslate nohighlight">\(f_L\)</span> can be regarded as the best
interpolating truncation approximation, up to degree <span class="math notranslate nohighlight">\(L\)</span>, for the function <span class="math notranslate nohighlight">\(f\)</span> on the
grid defined by <span class="math notranslate nohighlight">\(\theta_i\)</span> and <span class="math notranslate nohighlight">\(\varphi_j\)</span>.</p>
<p>If we consider the number of operations it takes to evaluate all the coefficients up to degree
<span class="math notranslate nohighlight">\(L\)</span>, we may note that there are <span class="math notranslate nohighlight">\((L + 1)^2\)</span> coefficients, and <span class="math notranslate nohighlight">\((L + 1)(2L + 1)\)</span>
grid points. Therefore it appears that it would take <span class="math notranslate nohighlight">\(\mathcal{O}(L^4)\)</span> operations to
evaluate all coefficients. However, at closer inspection, we may observe that it is possible to
first evaluate the intermediate coefficients</p>
<div class="math-wrapper docutils container">
<div class="math notranslate nohighlight">
\[\begin{split}f_m(\theta_i)=\sum_{j=0}^{2L}
\begin{Bmatrix}
    \cos(m\varphi_j)\\
    \sin(|m|\varphi_j)
\end{Bmatrix}
f(\theta_i,\varphi_j).\end{split}\]</div>
</div>
<p>This is nothing more than a discrete Fourier transform, and the intermediate coefficients can
therefore be evaluated in <span class="math notranslate nohighlight">\(\mathcal{O}(L^2\log L)\)</span> operations using a fast Fourier transform.
After that, the sums</p>
<div class="math-wrapper docutils container">
<div class="math notranslate nohighlight">
\[f_{lm}\approx\sum_{i=0}^{L}\bar{P}_l^m(z_i)f_m(\theta_i)\]</div>
</div>
<p>can be evaluated in <span class="math notranslate nohighlight">\(\mathcal{O}(L^3)\)</span> operations, leaving us with an operation count that
only grows as <span class="math notranslate nohighlight">\(\mathcal{O}(L^3)\)</span> to evaluate the spherical harmonic transform.</p>
<p>The inverse transform, from the coefficients back to the grid, can be performed using the same set
of operations in reverse. That is, we can first compute the intermediate coefficients
<span class="math notranslate nohighlight">\(f_m(\theta_i)\)</span> by summing <span class="math notranslate nohighlight">\(f_{lm}\)</span> over the associated Legendre polynomials, and then
perform a fast Fourier transform to get the gridded values <span class="math notranslate nohighlight">\(f(\theta_i,\varphi_j)\)</span>.</p>
</section>
<section id="zernike-functions">
<h2>Zernike functions<a class="headerlink" href="#zernike-functions" title="Link to this heading">¶</a></h2>
<p>The (3D) Zernike functions are a collection of functions that form an orthogonal basis on the unit
ball <span class="math notranslate nohighlight">\(B\)</span>, defined as the points <span class="math notranslate nohighlight">\(x\in\mathbb{R}^3\)</span> such that <span class="math notranslate nohighlight">\(\|x\|\leq 1\)</span>. It
is worth noting that, conventionally, “Zernike functions” or “Zernike polynomials”, refers to an
analogous collection of 2D functions that form a basis on the unit disk. Here we will refer to the
3D functions as simply “Zernike functions”.</p>
<p>The Zernike functions can be written as</p>
<div class="math-wrapper docutils container">
<div class="math notranslate nohighlight">
\[Z_{nlm}^{(\alpha)}(\rho,\theta,\varphi) = R_{nl}^{(\alpha)}(\rho)Y_{lm}(\theta,\varphi),\]</div>
</div>
<p>where the radial functions can be defined using Jacobi polyonomials <span class="math notranslate nohighlight">\(P_n^{\alpha,\beta}(x)\)</span> as</p>
<div class="math-wrapper docutils container">
<div class="math notranslate nohighlight">
\[R_{nl}^{(\alpha)}(\rho) = (1 - \rho^2)^\alpha\rho^lP_{(n-l)/2}^{(\alpha,l + 1/2)}(2\rho^2 - 1).\]</div>
</div>
<p>The parameter <span class="math notranslate nohighlight">\(\alpha\)</span> defines multiple families of Zernike polynomials. For practical
purposes, the family defined by <span class="math notranslate nohighlight">\(\alpha = 0\)</span> is the simplest to deal with, and is what is
used by this library. For this reason, we will denote the Zernike functions in this family simply
by <span class="math notranslate nohighlight">\(Z_{nlm}\)</span>.</p>
<p>An important point about Zernike functions is that because the indices <span class="math notranslate nohighlight">\((n-l)/2\)</span> of the
Jacobi polynomials must be nonnegative integers, <span class="math notranslate nohighlight">\(n\)</span> and <span class="math notranslate nohighlight">\(l\)</span> are restricted to having
the same parity. That is, if <span class="math notranslate nohighlight">\(n\)</span> is even, then <span class="math notranslate nohighlight">\(l\)</span> must be even, and if <span class="math notranslate nohighlight">\(n\)</span> is
odd, then <span class="math notranslate nohighlight">\(l\)</span> must be odd.</p>
<p>Since the Zernike functions form an orthogonal basis, any function on the unit ball can be written as</p>
<div class="math-wrapper docutils container">
<div class="math notranslate nohighlight">
\[f(\rho, \theta, \varphi) = \sum_{\frac{1}{2}(n-l)\in\mathbb{N}}\sum_{|m|\leq l}f_{nlm}Z_{nlm}(\rho,\theta,\varphi),\]</div>
</div>
<p>and we have an orthogonality relation</p>
<div class="math-wrapper docutils container">
<div class="math notranslate nohighlight">
\[\int_B Z_{nlm}(\rho,\theta,\varphi)Z_{n'l'm'}(\rho,\theta,\varphi)\, dV = N_{nlm}\delta_{nn'}\delta_{ll'}\delta_{mm'}.\]</div>
</div>
<p>The ambiquity about the phase and normalization of spherical harmonics naturally applies to Zernike
functions, but there is an additional ambiquity over the normalization of the radial Zernike
functions themselves. Per the definition of <span class="math notranslate nohighlight">\(R_{nl}^{(\alpha)}(\rho)\)</span> given above, we have an
orthogonality relation</p>
<div class="math-wrapper docutils container">
<div class="math notranslate nohighlight">
\[\int_0^1 R_{nl}^{(\alpha)}(\rho)R_{n'l}^{(\alpha)}(\rho)\frac{\rho^2\,d\rho}{(1-\rho^2)^\alpha} = N_{nl}^{(\alpha)}\delta_{nn'}.\]</div>
</div>
<p>with</p>
<div class="math-wrapper docutils container">
<div class="math notranslate nohighlight">
\[N_{nl}^{(\alpha)} = \frac{1}{2(n + \alpha + 3/2)}\frac{((n - l)/2 + 1)_\alpha}{((n - l)/2 + l + 3/2)_\alpha}.\]</div>
</div>
<p>The notation <span class="math notranslate nohighlight">\((x)_\alpha\)</span> is the Pochammer symbol, but we don’t need to worry about it much,
because under <span class="math notranslate nohighlight">\(\alpha = 0\)</span> the expression reduces to</p>
<div class="math-wrapper docutils container">
<div class="math notranslate nohighlight">
\[N_{nl}^{(0)} = \frac{1}{2n + 3}.\]</div>
</div>
<p>Like in the case of spherical harmonics, this normalization can be absorbed into the definition of
<span class="math notranslate nohighlight">\(R_{nl}^{(\alpha)}(\rho)\)</span> to get unit-normalized Zernike functions. Both conventions are
supported by zest.</p>
</section>
<section id="zernike-transforms">
<h2>Zernike transforms<a class="headerlink" href="#zernike-transforms" title="Link to this heading">¶</a></h2>
<p>Just as we have the spherical harmonic transform to obtain the spherical harmonic expansion
coefficients of a function defined on the sphere, we have a Zernike transform to obtain the Zernike
expansion coefficients of a function on the ball. Similarly to the case of spherical harmonics, it
is straightforward to see that the Zernike expansion coefficients of <span class="math notranslate nohighlight">\(f(\rho, \theta, \varphi)\)</span>
are given by</p>
<div class="math-wrapper docutils container">
<div class="math notranslate nohighlight">
\[f_{nlm} = \int_B f(\rho, \theta, \varphi)Z_{nlm}(\rho, \theta, \varphi)\rho^2\,d\rho\,d\Omega.\]</div>
</div>
<p>The numerical Zernike transform algorithm is effectively the same as the spherical harmonic
transform presented earlier with an extra dimension on the grid. That is, in addition to the points
<span class="math notranslate nohighlight">\(\theta_i\)</span>, and <span class="math notranslate nohighlight">\(\varphi_j\)</span>, we can define the points <span class="math notranslate nohighlight">\(\rho_k\)</span>, with
<span class="math notranslate nohighlight">\(k = 0,\ldots,L + 1\)</span>, such that <span class="math notranslate nohighlight">\(\rho_k = (x_k + 1)/2\)</span>, where <span class="math notranslate nohighlight">\(x_k\)</span> are
Gauss–Legendre nodes. Note that the radial direction requires one node more than the <span class="math notranslate nohighlight">\(\theta\)</span>
direction, because the radial integral comes with an extra factor of <span class="math notranslate nohighlight">\(\rho\)</span>. We can now write</p>
<div class="math-wrapper docutils container">
<div class="math notranslate nohighlight">
\[\begin{split}f_{nlm} \approx \sum_{k=0}^{L + 1}\sum_{i=0}{L}w_kw_i\rho_k^2R_{nl}(\rho_k)\bar{P}_l^m(z_i)\sum_{j=0}^{2L}
\begin{Bmatrix}
    \cos(m\varphi_j)\\
    \sin(|m|\varphi_j)
\end{Bmatrix}
f(\rho_k,\theta_i,\varphi_j).\end{split}\]</div>
</div>
<p>As is the case with the spherical harmonic transform, this transform can be performed stepwise,
first computing intermediate coefficients <span class="math notranslate nohighlight">\(f_m(\rho_k,\theta_i)\)</span>, by doing the innermost sum,
then the intermediate coefficients <span class="math notranslate nohighlight">\(f_{lm}(\rho_k)\)</span> from the middle sum, and then finally
<span class="math notranslate nohighlight">\(f_{nlm}\)</span> are obtained by doing the last sum. This means that the entire transformation can
be performed with <span class="math notranslate nohighlight">\(\mathcal{O}(L^4)\)</span> operations.</p>
</section>
<section id="rotations">
<h2>Rotations<a class="headerlink" href="#rotations" title="Link to this heading">¶</a></h2>
<p>It is common that we have a function expressed in terms of a spherical harmonic expansion</p>
<div class="math-wrapper docutils container">
<div class="math notranslate nohighlight">
\[f(\theta,\varphi) = \sum_{l=0}^{\infty}\sum_{|m|\leq l}f_{lm}Y_{lm}(\theta,\varphi).\]</div>
</div>
<p>and we express it in terms of coordinates <span class="math notranslate nohighlight">\((\theta',\varphi')\)</span>, which are related to the
coordinates <span class="math notranslate nohighlight">\((\theta,\varphi)\)</span> by a rotation <span class="math notranslate nohighlight">\(R\)</span>. The challenge is then to find
coefficients <span class="math notranslate nohighlight">\(f_{lm}'\)</span>, which express <span class="math notranslate nohighlight">\(f\)</span> in the rotated coordinate system,</p>
<div class="math-wrapper docutils container">
<div class="math notranslate nohighlight">
\[f(\theta',\varphi') = \sum_{l=0}^{\infty}\sum_{|m|\leq l}f_{lm}'Y_{lm}(\theta',\varphi').\]</div>
</div>
<p>The spherical harmonics in the different coordinate systems are related by a linear transformation,</p>
<div class="math-wrapper docutils container">
<div class="math notranslate nohighlight">
\[Y_l^m(\theta',\varphi') = \sum_{|m'|\leq l}D_{mm'}^{(l)}(R)^*Y_l^{m'}(\theta,\varphi).\]</div>
</div>
<p>Here <span class="math notranslate nohighlight">\(D_{mm'}^{(l)}(R)\)</span> are the elements of the Wigner D-matrix. Note that this relation is
specifically for the complex spherical harmonics. There is a corresponding matrix for real
spherical harmonics.</p>
<p>The above relation can be used to find the coefficients <span class="math notranslate nohighlight">\({f'}_l^m\)</span> of the complex sphericl
harmonic expansion,</p>
<div class="math-wrapper docutils container">
<div class="math notranslate nohighlight">
\[{f'}_l^m = \sum_{|m|\leq l}D_{mm'}^{(l)}(R)^*f_l^m.\]</div>
</div>
<p>In principle, for a given rotation defined, e.g., by Euler angles, it is possible to compute the
elements of the D-matrix and perform the matrix multiplication to get the rotation. However, an
alternative approach used by zest avoids computing the D-matrix. This approach relies on two facts.
First, that given Euler angles <span class="math notranslate nohighlight">\(\alpha\)</span>, <span class="math notranslate nohighlight">\(\beta\)</span>, and <span class="math notranslate nohighlight">\(gamma\)</span>, the D-matrix can
be expressed as</p>
<div class="math-wrapper docutils container">
<div class="math notranslate nohighlight">
\[D_{mm'}^{(l)}(\alpha,\beta,\gamma) = e^{-im\alpha}d_{mm'}^{(l)}(\beta)e^{-im'\gamma},\]</div>
</div>
<p>where <span class="math notranslate nohighlight">\(d_{mm'}^{(l)}(\beta)\)</span> are coefficients of the Wigner (small) d-matrix. The Euler
angles here specifically are in the ZYZ convention, where <span class="math notranslate nohighlight">\(\alpha\)</span> and <span class="math notranslate nohighlight">\(\gamma\)</span>
correspond to rotations about the Z-axis, and <span class="math notranslate nohighlight">\(\beta\)</span> corresponds to a rotation about the
Y-axis. The second fact is that a rotation about the Y-axis by angle <span class="math notranslate nohighlight">\(\beta\)</span> can be written
as a rotation about the X-axis by 90 degrees, followed by a rotation about the Z-axis by the angle
<span class="math notranslate nohighlight">\(\beta\)</span>, followed by another rotation about the X-axis by 90 degrees in the opposite
direction to the first one. This is the ZXZXZ method, which has the property that all the rotations
by variable angles are about the Z-axis, for which the D-matrix is diagonal. The X-rotations in
turn can be expressed in terms of the d-matrix elements <span class="math notranslate nohighlight">\(d_{mm'}^{(l)}(\pi/2)\)</span>, which need to
be computed once, and can be reused for all rotations.</p>
<p>When it comes to Zernike expansions, there is nothing special about the rotations compared to the
spherical harmonic case, because the rotation only operates on the angular part. Therefore once we
have determined how we apply the rotations to spherical harmonic coefficients, we get the
corresponding rotations on Zernike coefficients for free.</p>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="anatomy.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">Anatomy of zest</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="getting_started.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">Getting started</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2025, Sebastian Sassi
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">Theoretical background</a><ul>
<li><a class="reference internal" href="#spherical-harmonics">Spherical harmonics</a></li>
<li><a class="reference internal" href="#spherical-harmonic-transforms">Spherical harmonic transforms</a></li>
<li><a class="reference internal" href="#zernike-functions">Zernike functions</a></li>
<li><a class="reference internal" href="#zernike-transforms">Zernike transforms</a></li>
<li><a class="reference internal" href="#rotations">Rotations</a></li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script src="_static/documentation_options.js?v=01f34227"></script>
    <script src="_static/doctools.js?v=9bcbadda"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/scripts/furo.js?v=5fa4622c"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    </body>
</html>